---
globs: *.html
description: "HTML í…œí”Œë¦¿ ë‚´ JavaScript ë¬¸ë²• ì˜¤ë¥˜ ë°©ì§€ ë° ì•ˆì „í•œ ì²˜ë¦¬ ë°©ë²•"
---

# ğŸŒ Template JavaScript Safety Guide

## ğŸš¨ ì‹¤ì œ ë°œìƒí–ˆë˜ JavaScript í…œí”Œë¦¿ ì˜¤ë¥˜

### ë¬¸ì œ ë°œìƒ ì‚¬ë¡€:
```html
<!-- âŒ ì˜¤ë¥˜ ë°œìƒ íŒ¨í„´ë“¤ -->

<!-- 1. onclick ì†ì„±ì—ì„œ ë”°ì˜´í‘œ ì¶©ëŒ -->
<a onclick="editNote({{ note.id }}, '{{ note.note|replace("'", "\\'") }}')">

<!-- 2. ë‹«ëŠ” íƒœê·¸ ëˆ„ë½ -->
<a class="dropdown-item" href="#" onclick="deleteNote({{ note.id }})"
    <i class="bi bi-trash"></i>ì‚­ì œ  <!-- âŒ > ëˆ„ë½ -->
</a>

<!-- 3. JavaScript íŠ¹ìˆ˜ë¬¸ì ì²˜ë¦¬ ì‹¤íŒ¨ -->
<button onclick="alert('{{ message }}')">  <!-- messageì— ' í¬í•¨ì‹œ ì˜¤ë¥˜ -->

<!-- 4. ë°±í‹± í…œí”Œë¦¿ ë¦¬í„°ëŸ´ ì¶©ëŒ -->
<a onclick="func(`{{ content }}`)">  <!-- ë°±í‹± ë‚´ìš©ì— ë°±í‹± í¬í•¨ì‹œ ì˜¤ë¥˜ -->
```

## âœ… ì•ˆì „í•œ í…œí”Œë¦¿ JavaScript íŒ¨í„´

### 1. Data ì†ì„± + ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ê¶Œì¥)
```html
<!-- âœ… ì•ˆì „í•œ ë°©ì‹: data ì†ì„± ì‚¬ìš© -->
<a class="edit-note-btn" 
   data-note-id="{{ note.id }}" 
   data-note-content="{{ note.note }}"
   href="#">
    <i class="bi bi-pencil"></i>ìˆ˜ì •
</a>

<script>
// JavaScriptì—ì„œ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
document.querySelectorAll('.edit-note-btn').forEach(btn => {
    btn.addEventListener('click', function(e) {
        e.preventDefault();
        const noteId = this.dataset.noteId;
        const noteContent = this.dataset.noteContent;
        editNote(noteId, noteContent);
    });
});
</script>
```

### 2. JSON ë°ì´í„° ì „ë‹¬ (ë³µì¡í•œ ë°ì´í„°ìš©)
```html
<!-- âœ… ë³µì¡í•œ ë°ì´í„°ëŠ” JSONìœ¼ë¡œ -->
<script id="note-data" type="application/json">
{{ notes|tojson }}
</script>

<script>
// JavaScriptì—ì„œ ì•ˆì „í•˜ê²Œ íŒŒì‹±
const noteData = JSON.parse(document.getElementById('note-data').textContent);
noteData.forEach(note => {
    // ì•ˆì „í•˜ê²Œ ë°ì´í„° ì‚¬ìš©
    console.log(note.id, note.content);
});
</script>
```

### 3. í¼ ê¸°ë°˜ ì²˜ë¦¬ (POST ìš”ì²­ìš©)
```html
<!-- âœ… í¼ì„ í†µí•œ ì•ˆì „í•œ ë°ì´í„° ì „ì†¡ -->
<form method="POST" action="/notes/{{ note.id }}/delete" class="delete-form">
    <button type="button" class="delete-btn btn btn-danger">
        <i class="bi bi-trash"></i>ì‚­ì œ
    </button>
</form>

<script>
document.querySelectorAll('.delete-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            this.closest('.delete-form').submit();
        }
    });
});
</script>
```

## ğŸ›¡ï¸ í…œí”Œë¦¿ ë³´ì•ˆ ê²€ì¦ ì ˆì°¨

### Step 1: í…œí”Œë¦¿ ìˆ˜ì • ì „ ê²€ì¦
```bash
# í˜„ì¬ í˜ì´ì§€ê°€ ì •ìƒ ë Œë”ë§ë˜ëŠ”ì§€ í™•ì¸
curl -s http://localhost:5000/children/1 | grep -q "<!DOCTYPE html"
echo $? # 0ì´ë©´ ì •ìƒ
```

### Step 2: JavaScript ë¬¸ë²• ê²€ì¦
```html
<!-- ìˆ˜ì • í›„ ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ì—ì„œ í™•ì¸ -->
<script>
// Consoleì—ì„œ ì˜¤ë¥˜ í™•ì¸
console.log('Template JavaScript loaded successfully');
</script>
```

### Step 3: XSS ë°©ì§€ í™•ì¸
```python
# Python ë°±ì—”ë“œì—ì„œ ë°ì´í„° ì´ìŠ¤ì¼€ì´í•‘ í™•ì¸
from markupsafe import escape

# í…œí”Œë¦¿ìœ¼ë¡œ ì „ë‹¬í•˜ê¸° ì „ ì´ìŠ¤ì¼€ì´í•‘
note_content = escape(user_input)
```

## ğŸ”§ ë¬¸ì œ ë°œìƒ ì‹œ ë””ë²„ê¹… ë°©ë²•

### JavaScript ì˜¤ë¥˜ ì§„ë‹¨:
```javascript
// 1. ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ ì—´ê¸° (F12)
// 2. Console íƒ­ì—ì„œ ì˜¤ë¥˜ ë©”ì‹œì§€ í™•ì¸
// 3. ì˜¤ë¥˜ê°€ ë°œìƒí•œ ì¤„ ë²ˆí˜¸ í™•ì¸

// ì¼ë°˜ì ì¸ ì˜¤ë¥˜ íŒ¨í„´:
// - SyntaxError: Unexpected token
// - ReferenceError: function is not defined
// - TypeError: Cannot read property
```

### í…œí”Œë¦¿ ë Œë”ë§ ë¬¸ì œ ì§„ë‹¨:
```python
# Flask í…œí”Œë¦¿ ë Œë”ë§ ì˜¤ë¥˜ ë””ë²„ê¹…
@app.route('/debug/template')
def debug_template():
    try:
        return render_template('problematic_template.html', data=test_data)
    except Exception as e:
        return f"Template Error: {str(e)}"
```

## ğŸ“‹ í…œí”Œë¦¿ JavaScript ì•ˆì „ ì²´í¬ë¦¬ìŠ¤íŠ¸

### âœ… ìˆ˜ì • ì „ í™•ì¸:
- [ ] í˜„ì¬ í˜ì´ì§€ê°€ ì •ìƒ ë Œë”ë§ë˜ëŠ”ê°€?
- [ ] JavaScript ì½˜ì†”ì— ì˜¤ë¥˜ê°€ ì—†ëŠ”ê°€?
- [ ] ë™ì  ê¸°ëŠ¥ë“¤ì´ ì •ìƒ ì‘ë™í•˜ëŠ”ê°€?

### âœ… ìˆ˜ì • ì‹œ ì£¼ì˜ì‚¬í•­:
- [ ] `onclick` ëŒ€ì‹  `data` ì†ì„± + ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì‚¬ìš©í–ˆëŠ”ê°€?
- [ ] ëª¨ë“  HTML íƒœê·¸ê°€ ì˜¬ë°”ë¥´ê²Œ ë‹«í˜”ëŠ”ê°€?
- [ ] íŠ¹ìˆ˜ë¬¸ìê°€ í¬í•¨ëœ ë°ì´í„°ë¥¼ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í–ˆëŠ”ê°€?
- [ ] XSS ë°©ì§€ë¥¼ ìœ„í•œ ì´ìŠ¤ì¼€ì´í•‘ì´ ì ìš©ë˜ì—ˆëŠ”ê°€?

### âœ… ìˆ˜ì • í›„ ê²€ì¦:
- [ ] ë¸Œë¼ìš°ì €ì—ì„œ í˜ì´ì§€ê°€ ì •ìƒ ë¡œë“œë˜ëŠ”ê°€?
- [ ] JavaScript ì½˜ì†”ì— ìƒˆë¡œìš´ ì˜¤ë¥˜ê°€ ì—†ëŠ”ê°€?
- [ ] ìˆ˜ì •í•œ ê¸°ëŠ¥ì´ ì˜ˆìƒëŒ€ë¡œ ì‘ë™í•˜ëŠ”ê°€?
- [ ] ë‹¤ë¥¸ í˜ì´ì§€ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šì•˜ëŠ”ê°€?

## ğŸš¨ ì‘ê¸‰ ë³µêµ¬ ì ˆì°¨

### JavaScript ì˜¤ë¥˜ë¡œ í˜ì´ì§€ê°€ ì‘ë™í•˜ì§€ ì•ŠëŠ” ê²½ìš°:
```bash
# 1. ì´ì „ ë²„ì „ìœ¼ë¡œ ì¦‰ì‹œ ë¡¤ë°±
git checkout HEAD~1 -- templates/children/detail.html

# 2. ì„œë²„ ì¬ì‹œì‘ í›„ í…ŒìŠ¤íŠ¸
python app.py

# 3. ë¬¸ì œê°€ í•´ê²°ë˜ë©´ ë‹¨ê³„ë³„ ì¬ìˆ˜ì •
```

### íŠ¹ì • ê¸°ëŠ¥ë§Œ ì˜¤ë¥˜ì¸ ê²½ìš°:
```html
<!-- ì„ì‹œë¡œ í•´ë‹¹ ê¸°ëŠ¥ ë¹„í™œì„±í™” -->
<button disabled>
    <i class="bi bi-pencil"></i>ìˆ˜ì • (ì„ì‹œ ë¹„í™œì„±í™”)
</button>
```

## ğŸ’¡ ëª¨ë²” ì‚¬ë¡€ íŒ¨í„´

### 1. ì´ë²¤íŠ¸ ìœ„ì„ ì‚¬ìš©
```javascript
// âœ… íš¨ìœ¨ì ì¸ ì´ë²¤íŠ¸ ì²˜ë¦¬
document.addEventListener('click', function(e) {
    if (e.target.matches('.edit-note-btn')) {
        const noteId = e.target.dataset.noteId;
        const noteContent = e.target.dataset.noteContent;
        editNote(noteId, noteContent);
    }
    
    if (e.target.matches('.delete-note-btn')) {
        const noteId = e.target.dataset.noteId;
        deleteNote(noteId);
    }
});
```

### 2. ì—ëŸ¬ ì²˜ë¦¬ í¬í•¨
```javascript
// âœ… ì•ˆì „í•œ í•¨ìˆ˜ ì •ì˜
function editNote(noteId, noteContent) {
    try {
        if (!noteId || !noteContent) {
            throw new Error('Invalid note data');
        }
        
        // ëª¨ë‹¬ í‘œì‹œ ë¡œì§
        const modal = new bootstrap.Modal(document.getElementById('editNoteModal'));
        document.getElementById('editNoteText').value = noteContent;
        modal.show();
        
    } catch (error) {
        console.error('Error editing note:', error);
        alert('ë…¸íŠ¸ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
}
```

### 3. í…œí”Œë¦¿ ë³€ìˆ˜ ê²€ì¦
```html
<!-- âœ… ì•ˆì „í•œ í…œí”Œë¦¿ ë³€ìˆ˜ ì‚¬ìš© -->
{% if note and note.id %}
<a class="edit-note-btn" 
   data-note-id="{{ note.id }}" 
   data-note-content="{{ note.note|e }}"  <!-- |e í•„í„°ë¡œ ì´ìŠ¤ì¼€ì´í•‘ -->
   href="#">ìˆ˜ì •</a>
{% endif %}
```

## ğŸ¯ í•µì‹¬ ì›ì¹™

1. **onclick ê¸ˆì§€**: ì ˆëŒ€ onclick ì†ì„±ì— ë³µì¡í•œ ë¡œì§ ë„£ì§€ ì•Šê¸°
2. **ë°ì´í„° ë¶„ë¦¬**: HTMLê³¼ JavaScript ë¡œì§ ëª…í™•íˆ ë¶„ë¦¬
3. **ì•ˆì „í•œ ì „ë‹¬**: data ì†ì„±ì´ë‚˜ JSONì„ í†µí•œ ì•ˆì „í•œ ë°ì´í„° ì „ë‹¬
4. **ì ì§„ì  í–¥ìƒ**: JavaScript ì—†ì´ë„ ê¸°ë³¸ ê¸°ëŠ¥ì€ ì‘ë™í•˜ë„ë¡ ì„¤ê³„
5. **ì¦‰ì‹œ ê²€ì¦**: ìˆ˜ì • í›„ ë°˜ë“œì‹œ ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ í…ŒìŠ¤íŠ¸

## ğŸ” ì¶”ê°€ ê²€ì¦ ë„êµ¬

### HTML ê²€ì¦:
```bash
# HTML ë¬¸ë²• ê²€ì‚¬ (ì„ íƒì‚¬í•­)
pip install html5lib
python -c "
import html5lib
with open('templates/children/detail.html', 'r', encoding='utf-8') as f:
    content = f.read()
    try:
        html5lib.parse(content)
        print('âœ… HTML êµ¬ë¬¸ ê²€ì‚¬ í†µê³¼')
    except Exception as e:
        print(f'âŒ HTML ì˜¤ë¥˜: {e}')
"
```

### JavaScript ë¦°íŒ… (ì„ íƒì‚¬í•­):
```bash
# JavaScript ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬
npx jshint static/js/script.js
```